version: "3"

volumes:
  postgres:

networks:
  lng:
  frontend:

services:
  proxy:
    build: proxy
    ports:
      - "80:80"
    networks:
      - frontend
    depends_on:
      - web
      - api
    environment:
      - TZ=Europe/Oslo

  web:
    image: gpa-web
    build: web
    networks:
      - frontend

  api:
    image: gpa-api
    build: main-api
    networks:
      - frontend
      - lng

  lng:
    image: lng-api
    build: lng
    networks:
      - lng
      - frontend
    depends_on:
      - lngdb
    environment:
      - DB_URL=jdbc:postgresql://lngdb:5432/neqsim
      - DB_USERNAME=neqsim
      - DB_PASSWORD=${POSTGRES_PASSWORD}

  lngdb:
    image: postgres:10-alpine
    networks:
      - lng
    ports:
      - "5432:5432"
    volumes:
      - "postgres:/var/lib/postgresql/data"
    environment:
      - POSTGRES_USER=neqsim
      - POSTGRES_DB=neqsim
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
